import{r as t,c as a,h as e,H as n}from"./p-d4191909.js";import"./p-8fa78097.js";import{d as o,F as i,l as r,m as s,q as c,p as l}from"./p-cfeaffc4.js";import{H as d}from"./p-813bc48c.js";import"./p-3794fa4c.js";import{p as h}from"./p-f8a2682a.js";import"./p-e506992e.js";import{B as p}from"./p-98de6189.js";const b=class{constructor(n){t(this,n),this.getModelEvent=a(this,"webcardinal:model:get",7),this.pageSize=20,this.pageSizeDelta=2,this.curentPageIndex=0,this.hidePagination=!1,this.getTemplatesFromDOM=()=>{const t={header:[],data:[]},a=Object.keys(t);for(const e of Array.from(this.host.children))if(e.hasAttribute("slot")){if(a.includes(e.slot)){const{slot:a}=e;e.removeAttribute("slot"),e.classList.add("webc-datatable--"+a),t[a].push(e)}}else t.data.push(e);return t},this.getDataSourceFromModel=async()=>{let{chain:t}=this;return t.startsWith(o)&&(t=t.substring(1)),(await h(this.getModelEvent)).getChainValue(t)},this.renderPagination=()=>{const t=this.curentPageIndex+1,a=this.dataSize?Math.ceil(this.dataSize/this.pageSize):1,n=[],o=function(t,a,e=2){const n=[],o=[];if(a<=1)return n;n.push(1);for(let o=t-e;o<=t+e;o++)o<a&&o>1&&n.push(o);let i;n.push(a);for(let t of n)i&&(t-i==2?o.push(i+1):t-i!=1&&o.push("...")),o.push(t),i=t;return o}(t,a,this.pageSizeDelta);for(const a of o)if("number"!=typeof a)"string"==typeof a&&n.push(a);else{if(a===t){n.push(e("button",{active:!0,part:"pagination-button pagination-button--active",disabled:!0},a));continue}n.push(e("button",{part:"pagination-button",onClick:()=>this.dataSource.goToPageByIndex(a-1)},a))}return 1!==a&&(n.unshift(e("button",{part:"pagination-button pagination-button--previous",disabled:1===t,onClick:()=>this.dataSource.goToPreviousPage()},"‹")),n.push(e("button",{part:"pagination-button pagination-button--next",disabled:t===a,onClick:()=>this.dataSource.goToNextPage()},"›"))),n}}async componentWillLoad(){if(!this.host.isConnected)return;this.dataSource=await this.getDataSourceFromModel();const{DataSource:t}=window.WebCardinal.dataSources;if(!(this.dataSource&&"object"==typeof this.dataSource&&this.dataSource instanceof t))return void console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [1]`,this.dataSource);try{this.model=await this.dataSource._init((()=>this.host))}catch(t){return console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [2]`,this.dataSource),void(this.dataSource=void 0)}const{header:a,data:e}=this.getTemplatesFromDOM();this.host.classList.add("webc-datatable");const n=document.createElement("style");n.innerHTML='\n[data-sortable] {\n    --header-arrow-size: 0.25rem;\n    --header-arrow-color: #BBBBBB;\n\n    cursor: pointer;\n    position: relative;\n    padding-right: calc(5 * var(--header-arrow-size));\n}\n\n[data-sortable]::before,\n[data-sortable]::after {\n    content: "";\n    height: 0;\n    width: 0;\n    position: absolute;\n    right: 4px;\n    border-left: var(--header-arrow-size) solid transparent;\n    border-right: var(--header-arrow-size) solid transparent;\n    opacity: 1;\n}\n\n[data-sortable]::before {\n    border-bottom: var(--header-arrow-size) solid var(--header-arrow-color);\n    border-top: var(--header-arrow-size) solid transparent;\n    bottom: 55%;\n}\n\n[data-sortable]::after {\n    border-top: var(--header-arrow-size) solid var(--header-arrow-color);\n    top: 55%;\n}\n';const d=document.createElement("div");d.setAttribute("slot","data"),d.classList.add("webc-datatable--container"),d.setAttribute(i,o+"data"),d.setAttribute(r,""+s),d.append(...e),d.addEventListener(c,(t=>{t.stopImmediatePropagation(),d.prepend(...a)})),d.addEventListener(l,(t=>{t.stopImmediatePropagation()})),this.host.append(n,d),p.bindChildNodes(this.host,{model:this.model,translationModel:{},recursive:!0,enableTranslations:!1}),d.prepend(...a),this.dataSource._renderPageAsync()}async fillCurrentPage(t){this.model.data=t}async clearCurrentPage(){this.model.data.length=0}pageSizeHandler(){this.dataSource._renderPageAsync()}render(){return this.dataSource?e(n,null,e("slot",{name:"before"}),e("slot",{name:"data"}),this.hidePagination?null:e("div",{part:"pagination",class:"pagination"},this.renderPagination()),e("slot",{name:"footer"}),e("slot",{name:"after"})):null}static get watchers(){return{pageSize:["pageSizeHandler"]}}};(function(t,a,e,n){var o,i=arguments.length,r=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,a,e,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(i<3?o(r):i>3?o(a,e,r):o(a,e))||r);i>3&&r&&Object.defineProperty(a,e,r)})([d()],b.prototype,"host",void 0),b.style={default:":host .pagination{display:flex;gap:var(--pagination-gap);justify-content:center}:host .pagination>button{font-size:inherit;border:var(--pagination-button-border);background:var(--pagination-button-background)}:host .pagination>button:not([disabled]){cursor:pointer}:host .pagination>button[active]{color:inherit;font-weight:bold}"};export{b as webc_datatable}